<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buzzer Bombardment</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <style>
    .topbar { display:flex; align-items:center; justify-content:space-between; gap:12px; margin:16px 0; }
    .stats { display:flex; gap:12px; flex-wrap:wrap; }
    .pill { background:#eef2ff; border:1px solid #c7d2fe; padding:6px 10px; border-radius:999px; }
    .arena { position:relative; width:100%; max-width:900px; height:480px; margin:0 auto; background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 1px 2px rgba(0,0,0,0.04); overflow:hidden; }
    .target { position:absolute; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; cursor:pointer; user-select:none; transition: transform 0.1s ease, opacity 0.1s ease; }
    .target:hover { transform: scale(1.1); opacity: 0.9; }
    .target.valid { background:#10b981; }
    .target.fake { background:#ef4444; }
    .target.square { border-radius:8px; }
    .target.triangle { border-radius:0; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
    .overlay { position:absolute; inset:0; background:rgba(0,0,0,0.0); color:#fff; display:flex; align-items:center; justify-content:center; font-size:1.3rem; font-weight:800; pointer-events:none; transition:background 100ms; }
    .overlay.show { background:rgba(0,0,0,0.35); }
    .hidden { display:none; }
    .btn { background:#0ea5e9; color:white; border:none; padding:8px 14px; border-radius:8px; cursor:pointer; font-weight:700; }
    .btn.secondary { background:#e2e8f0; color:#111827; }
    .summary { background:#ecfeff; border:1px solid #a5f3fc; border-radius:10px; padding:14px; margin-top:16px; }

    /* Modal for instructions (pointer events enabled) */
    .modal-backdrop { position:absolute; inset:0; background:rgba(0,0,0,0.55); display:flex; align-items:center; justify-content:center; z-index:10; pointer-events:auto; }
    .modal-card { background:#ffffff; color:#0f172a; padding:16px 18px; border-radius:12px; max-width:720px; width:min(92%, 720px); text-align:left; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
    .modal-card h2 { margin:4px 0 8px 0; font-size:1.1rem; }
    .modal-card p { margin:0 0 6px 0; color:#334155; font-size:0.95rem; }
    .modal-card ul { margin:8px 0 10px 18px; line-height:1.4; color:#334155; font-size:0.95rem; }
    .modal-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:8px; }
  </style>
</head>
<body>
  <header>
    <h1>Buzzer Bombardment</h1>
    <p class="subtitle">Tap green targets, avoid red ones. Distractions and rule changes will occur. Game lasts 60s.</p>
  </header>

  <main>
    <div class="topbar">
      <div class="stats">
        <span class="pill">Time: <span id="time">60.0</span>s</span>
        <span class="pill">Hits: <span id="hits">0</span></span>
        <span class="pill">Errors: <span id="errors">0</span></span>
        <span class="pill">Avg RT: <span id="avgRt">-</span> ms</span>
        <span class="pill">Rule: <span id="ruleBanner">Normal</span></span>
      </div>
      <div>
        <button id="startBtn" class="btn">Start</button>
        <a href="/" class="btn secondary">Back</a>
      </div>
    </div>

    <div id="arena" class="arena" aria-label="Game arena"></div>
    <div id="overlay" class="overlay hidden"></div>

    <!-- Instructions modal (no calibration, no practice) -->
    <div id="instructions" class="modal-backdrop">
      <div class="modal-card">
        <h2>How to play</h2>
        <p>Quick guide:</p>
        <ul>
          <li>Tap the <strong>GREEN</strong> targets (circles, squares, triangles) quickly.</li>
          <li>Avoid tapping the <strong>RED</strong> targets—they are fake and count as errors.</li>
          <li>Visual distractions and brief rule changes (e.g., "Only squares") will appear. Stay focused.</li>
          <li>When a rule shows, follow it briefly, then resume normal.</li>
          <li>Targets may move slightly. The round is ~60s and becomes more challenging.</li>
        </ul>
        <div class="modal-actions">
          <button id="startFromModal" class="btn">Start Now</button>
        </div>
      </div>
    </div>

    <section id="summary" class="summary hidden">
      <h2>Session Summary</h2>
      <p>Accuracy: <strong id="sumAcc">-</strong>% | Avg RT: <strong id="sumRt">-</strong> ms | Impulsivity: <strong id="sumImp">-</strong></p>
      <div id="distractionSummary"></div>
      <div style="margin-top:16px;">
        <p style="margin-bottom:12px;"><strong>Next Step:</strong> Proceed to video analysis to complete your assessment.</p>
        <a href="/video" class="btn" style="display:inline-block; margin-right:10px;">Continue to Video Analysis →</a>
        <a href="/" class="btn secondary" style="display:inline-block;">Return Home</a>
      </div>
    </section>
  </main>

  <footer>
    <small>© 2025 PHQ-8 + Game Demo</small>
  </footer>

  <script src="/static/game.js"></script>
</body>
</html>
